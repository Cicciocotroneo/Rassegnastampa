<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema di Rassegna Stampa</title>
    <style>
        :root {
            --primary-color: #5A6AB1;
            --primary-light: #7B89D9;
            --primary-dark: #4A5696;
            --secondary-color: #F6F8FC;
            --text-color: #333;
            --light-text: #666;
            --border-color: #E0E4E8;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #f44336;
            --bg-color: #F6F8FC;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        h1, h2, h3 {
            color: var(--primary-dark);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .form-container {
            margin-bottom: 20px;
            display: flex;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        input[type="url"], input[type="text"] {
            flex: 1;
            padding: 12px;
            margin-right: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="url"]:focus, input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(90, 106, 177, 0.2);
        }
        
        button {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        
        .section-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #extraction-results {
            display: none;
        }
        
        .field-container {
            margin-bottom: 20px;
        }
        
        .field-label {
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
            color: var(--primary-dark);
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }
        
        textarea {
            min-height: 300px;
            resize: vertical;
            line-height: 1.5;
        }
        
        .error {
            color: var(--error-color);
            font-weight: 500;
            padding: 12px;
            background-color: rgba(244, 67, 54, 0.1);
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .success {
            color: var(--success-color);
            font-weight: 500;
            padding: 12px;
            background-color: rgba(76, 175, 80, 0.1);
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            font-style: italic;
            color: var(--light-text);
            padding: 10px;
        }
        
        .info-text {
            color: var(--light-text);
            font-style: italic;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            margin-top: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Colori dei pulsanti */
        #save-article-btn {
            background-color: var(--primary-color);
        }
        
        #save-article-btn:hover {
            background-color: var(--primary-dark);
        }
        
        #cancel-extraction-btn {
            background-color: var(--light-text);
        }
        
        #cancel-extraction-btn:hover {
            background-color: #555;
        }
        
        #generate-press-review-btn {
            background-color: var(--primary-color);
        }
        
        #generate-press-review-btn:hover {
            background-color: var(--primary-dark);
        }
        
        #export-data-btn, #import-data-btn {
            background-color: var(--primary-light);
        }
        
        #export-data-btn:hover, #import-data-btn:hover {
            background-color: var(--primary-color);
        }
        
        #reset-data-btn {
            background-color: var(--error-color);
        }
        
        #reset-data-btn:hover {
            background-color: #d32f2f;
        }
        
        /* Stili per i contenitori */
        #saved-articles-container, #saved-reviews-container {
            margin-top: 30px;
            display: none;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: white;
        }
        
        .data-table th, .data-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }
        
        .data-table th {
            background-color: var(--secondary-color);
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .data-table tr:nth-child(even) {
            background-color: rgba(246, 248, 252, 0.5);
        }
        
        .data-table tr:hover {
            background-color: rgba(90, 106, 177, 0.05);
        }
        
        .action-cell {
            white-space: nowrap;
        }
        
        .action-cell button {
            padding: 8px 12px;
            font-size: 14px;
            margin-right: 5px;
        }
        
        /* Stili per il modal della rassegna stampa */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #ddd;
            width: 90%;
            max-width: 900px;
            position: relative;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 0.8;
        }
        
        .close-modal:hover {
            color: black;
        }
        
        /* Stili per la visualizzazione della rassegna stampa */
        @media print {
            body * {
                visibility: hidden;
            }
            body {
                background-color: white !important;
            }
            #press-review-modal, #press-review-modal * {
                visibility: visible;
            }
            #press-review-modal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                overflow: visible;
                background-color: white;
            }
            #press-review-content {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: visible !important;
            }
            .modal-header, .modal-buttons {
                display: none !important;
            }
            .press-review-articles {
                overflow: visible !important;
                height: auto !important;
            }
            .modal-content {
                box-shadow: none !important;
                border: none !important;
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
        }
        
        #press-review-content {
            background-color: white;
            font-family: 'Georgia', 'Times New Roman', Times, serif;
            padding: 20px;
            margin-top: 20px;
            overflow: visible;
        }
        
        .press-review-header {
            text-align: center;
            border-bottom: 2px solid black;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        .press-review-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .press-review-date {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .press-review-articles {
            column-count: 2;
            column-gap: 40px;
            column-rule: 1px solid #eee;
            text-align: justify;
            overflow: visible;
        }
        
        .press-review-article {
            break-inside: avoid;
            margin-bottom: 30px;
            overflow: visible;
        }
        
        .article-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        .article-source {
            font-style: italic;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .article-author {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .article-content {
            font-size: 16px;
            line-height: 1.5;
        }
        
        .article-content p {
            text-indent: 20px;
            margin-bottom: 10px;
            hyphens: auto;
        }
        
        .article-content p:first-child {
            text-indent: 0;
        }
        
        .dropcap {
            float: left;
            font-size: 60px;
            line-height: 1;
            font-weight: bold;
            margin-right: 8px;
            margin-top: -2px;
            color: var(--primary-dark);
        }
        
        .modal-buttons {
            margin-top: 20px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Stili per il modal di importazione/esportazione */
        #import-export-modal textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 14px;
            padding: 10px;
        }
        
        /* Stili per le etichette */
        .section-label {
            font-size: 20px;
            font-weight: 500;
            color: var(--primary-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .section-label::after {
            content: "";
            flex-grow: 1;
            height: 1px;
            margin-left: 15px;
            background-color: var(--border-color);
        }
        
        /* Stili per le tabs */
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 5px;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
        }
        
        .tab.active {
            background-color: white;
            border-color: var(--border-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tooltip per i pulsanti */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>Sistema di Rassegna Stampa</h1>
    
    <div class="form-container">
        <input type="url" id="url-input" placeholder="Inserisci l'URL dell'articolo..." required>
        <button id="extract-button">Estrai Articolo</button>
    </div>
    
    <div id="status-message"></div>
    
    <div id="extraction-results" class="section-container">
        <div class="section-label">Estrazione Articolo</div>
        
        <div class="field-container">
            <label class="field-label" for="title-field">Titolo:</label>
            <input type="text" id="title-field">
        </div>
        
        <div class="field-container">
            <label class="field-label" for="author-field">Autore:</label>
            <input type="text" id="author-field">
            <div class="info-text">Può essere modificato se non rilevato correttamente</div>
        </div>
        
        <div class="field-container">
            <label class="field-label" for="url-field">Fonte URL:</label>
            <input type="text" id="url-field">
        </div>
        
        <div class="field-container">
            <label class="field-label" for="source-name-field">Nome della Fonte:</label>
            <input type="text" id="source-name-field" placeholder="es. La Repubblica, Il Corriere della Sera, ecc.">
        </div>
        
        <div class="field-container">
            <label class="field-label" for="content-field">Contenuto dell'Articolo:</label>
            <textarea id="content-field"></textarea>
        </div>
        
        <div class="action-buttons">
            <button id="save-article-btn">Salva Articolo</button>
            <button id="cancel-extraction-btn">Annulla</button>
        </div>
    </div>
    
    <div class="tab-container">
        <div class="tab active" data-tab="articles">Articoli</div>
        <div class="tab" data-tab="reviews">Rassegne Salvate</div>
    </div>
    
    <div id="saved-articles-container" class="tab-content active section-container">
        <div class="section-label">Articoli Salvati</div>
        <p>Da qui puoi gestire gli articoli salvati e generare la rassegna stampa.</p>
        
        <div class="action-buttons">
            <button id="generate-press-review-btn" class="tooltip">
                Genera Rassegna Stampa
                <span class="tooltiptext">Crea una nuova rassegna con gli articoli selezionati</span>
            </button>
            <button id="export-data-btn" class="tooltip">
                Esporta Dati
                <span class="tooltiptext">Esporta gli articoli in formato CSV</span>
            </button>
            <button id="import-data-btn" class="tooltip">
                Importa Dati
                <span class="tooltiptext">Importa articoli da formato CSV</span>
            </button>
            <button id="reset-data-btn" class="tooltip">
                Elimina Tutti
                <span class="tooltiptext">Rimuovi tutti gli articoli salvati</span>
            </button>
        </div>
        
        <table class="data-table" id="saved-articles-table">
            <thead>
                <tr>
                    <th>Titolo</th>
                    <th>Fonte</th>
                    <th>Autore</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody id="saved-articles-body">
                <!-- Gli articoli salvati verranno inseriti qui dinamicamente -->
            </tbody>
        </table>
    </div>
    
    <div id="saved-reviews-container" class="tab-content section-container">
        <div class="section-label">Rassegne Stampa Salvate</div>
        <p>Qui puoi visualizzare e gestire le rassegne stampa che hai salvato.</p>
        
        <table class="data-table" id="saved-reviews-table">
            <thead>
                <tr>
                    <th>Titolo</th>
                    <th>Data</th>
                    <th>Articoli</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody id="saved-reviews-body">
                <!-- Le rassegne salvate verranno inserite qui dinamicamente -->
            </tbody>
        </table>
    </div>
    
    <!-- Modal per la rassegna stampa -->
    <div id="press-review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" id="close-press-review">&times;</span>
                <h2>Anteprima Rassegna Stampa</h2>
            </div>
            <div id="press-review-content">
                <!-- Il contenuto della rassegna stampa verrà inserito qui dinamicamente -->
            </div>
            <div class="modal-buttons">
                <button id="print-press-review-btn">Stampa PDF</button>
                <button id="save-press-review-btn">Salva Rassegna</button>
                <button id="close-press-review-btn">Chiudi</button>
            </div>
        </div>
    </div>
    
    <!-- Modal per import/export -->
    <div id="import-export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" id="close-import-export">&times;</span>
                <h2 id="import-export-title">Esporta Dati</h2>
            </div>
            <p id="import-export-description">Copia i dati sottostanti o salvali in un file CSV per backup.</p>
            <textarea id="import-export-textarea"></textarea>
            <div class="modal-buttons">
                <button id="copy-export-btn">Copia negli Appunti</button>
                <button id="confirm-import-btn">Importa</button>
                <button id="download-csv-btn">Scarica CSV</button>
                <button id="close-import-export-btn">Chiudi</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementi DOM
            const urlInput = document.getElementById('url-input');
            const extractButton = document.getElementById('extract-button');
            const extractionResults = document.getElementById('extraction-results');
            const statusMessage = document.getElementById('status-message');
            const titleField = document.getElementById('title-field');
            const authorField = document.getElementById('author-field');
            const urlField = document.getElementById('url-field');
            const sourceNameField = document.getElementById('source-name-field');
            const contentField = document.getElementById('content-field');
            const saveArticleBtn = document.getElementById('save-article-btn');
            const cancelExtractionBtn = document.getElementById('cancel-extraction-btn');
            const savedArticlesContainer = document.getElementById('saved-articles-container');
            const savedReviewsContainer = document.getElementById('saved-reviews-container');
            const savedArticlesBody = document.getElementById('saved-articles-body');
            const savedReviewsBody = document.getElementById('saved-reviews-body');
            const generatePressReviewBtn = document.getElementById('generate-press-review-btn');
            const exportDataBtn = document.getElementById('export-data-btn');
            const importDataBtn = document.getElementById('import-data-btn');
            const resetDataBtn = document.getElementById('reset-data-btn');
            
            // Tabs
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Modal per la rassegna stampa
            const pressReviewModal = document.getElementById('press-review-modal');
            const closePressReview = document.getElementById('close-press-review');
            const pressReviewContent = document.getElementById('press-review-content');
            const printPressReviewBtn = document.getElementById('print-press-review-btn');
            const savePressReviewBtn = document.getElementById('save-press-review-btn');
            const closePressReviewBtn = document.getElementById('close-press-review-btn');
            
            // Modal per import/export
            const importExportModal = document.getElementById('import-export-modal');
            const closeImportExport = document.getElementById('close-import-export');
            const importExportTitle = document.getElementById('import-export-title');
            const importExportDescription = document.getElementById('import-export-description');
            const importExportTextarea = document.getElementById('import-export-textarea');
            const copyExportBtn = document.getElementById('copy-export-btn');
            const confirmImportBtn = document.getElementById('confirm-import-btn');
            const downloadCsvBtn = document.getElementById('download-csv-btn');
            const closeImportExportBtn = document.getElementById('close-import-export-btn');
            
            // Array per memorizzare gli articoli
            let savedArticles = [];
            // Array per memorizzare le rassegne stampa
            let savedPressReviews = [];
            // Oggetto per l'articolo corrente in fase di modifica
            let currentEditArticle = null;
            // La rassegna attualmente visualizzata
            let currentReview = null;
            
            // Gestione delle tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    // Attiva la tab corrente
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Mostra il contenuto corrispondente
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id.includes(tabName)) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Carica gli articoli salvati dal localStorage
            loadSavedData();
            
            // Event listener per l'estrazione dell'articolo
            extractButton.addEventListener('click', function() {
                const url = urlInput.value.trim();
                
                if (!url) {
                    showStatus('error', 'Per favore, inserisci un URL valido.');
                    return;
                }
                
                // Nascondi i risultati precedenti e mostra lo stato di caricamento
                extractionResults.style.display = 'none';
                statusMessage.textContent = '';
                currentEditArticle = null;
                resetExtractionFields();
            });
            
            // Event listener per generare la rassegna stampa
            generatePressReviewBtn.addEventListener('click', function() {
                if (savedArticles.length === 0) {
                    showStatus('error', 'Non ci sono articoli salvati per generare una rassegna stampa.');
                    return;
                }
                
                // Genera la rassegna stampa
                generatePressReview();
                currentReview = null; // Indica che stiamo creando una nuova rassegna
                
                // Mostra il modal
                pressReviewModal.style.display = 'block';
            });
            
            // Event listener per esportare i dati
            exportDataBtn.addEventListener('click', function() {
                prepareExport();
                importExportModal.style.display = 'block';
            });
            
            // Event listener per importare i dati
            importDataBtn.addEventListener('click', function() {
                prepareImport();
                importExportModal.style.display = 'block';
            });
            
            // Event listener per il reset dei dati
            resetDataBtn.addEventListener('click', function() {
                if (confirm('Sei sicuro di voler eliminare tutti gli articoli salvati? Questa azione non può essere annullata.')) {
                    savedArticles = [];
                    saveArticlesToLocalStorage();
                    updateSavedArticlesTable();
                    showStatus('success', 'Tutti gli articoli sono stati eliminati.');
                }
            });
            
            // Event listener per la stampa della rassegna come PDF
            printPressReviewBtn.addEventListener('click', function() {
                // Assicuriamoci che il contenuto della rassegna sia ottimizzato prima di stampare
                const bodyElement = document.body;
                bodyElement.classList.add('printing');
                
                setTimeout(() => {
                    window.print();
                    bodyElement.classList.remove('printing');
                }, 300);
            });
            
            // Event listener per salvare la rassegna
            savePressReviewBtn.addEventListener('click', function() {
                // Se stiamo visualizzando una rassegna esistente
                if (currentReview) {
                    showStatus('info', 'Questa rassegna è già stata salvata.');
                    pressReviewModal.style.display = 'none';
                    return;
                }
                
                // Salva la rassegna attuale
                const currentDate = new Date();
                const reviewId = generateUniqueId();
                const reviewTitle = `Rassegna Stampa ${formatDate(currentDate)}`;
                
                const reviewData = {
                    id: reviewId,
                    title: reviewTitle,
                    date: currentDate.toISOString(),
                    articles: savedArticles.map(article => article.id),
                    htmlContent: pressReviewContent.innerHTML,
                    createdDate: currentDate.toISOString()
                };
                
                savedPressReviews.push(reviewData);
                saveReviewsToLocalStorage();
                updateSavedReviewsTable();
                
                showStatus('success', 'Rassegna stampa salvata con successo!');
                pressReviewModal.style.display = 'none';
                
                // Passa alla tab delle rassegne
                document.querySelector('.tab[data-tab="reviews"]').click();
            });
            
            // Event listeners per chiudere i modal
            closePressReview.addEventListener('click', function() {
                pressReviewModal.style.display = 'none';
            });
            
            closePressReviewBtn.addEventListener('click', function() {
                pressReviewModal.style.display = 'none';
            });
            
            closeImportExport.addEventListener('click', function() {
                importExportModal.style.display = 'none';
            });
            
            closeImportExportBtn.addEventListener('click', function() {
                importExportModal.style.display = 'none';
            });
            
            // Event listener per copiare i dati esportati
            copyExportBtn.addEventListener('click', function() {
                importExportTextarea.select();
                document.execCommand('copy');
                showStatus('success', 'Dati copiati negli appunti!');
            });
            
            // Event listener per confermare l'importazione
            confirmImportBtn.addEventListener('click', function() {
                const importData = importExportTextarea.value.trim();
                if (!importData) {
                    showStatus('error', 'Nessun dato da importare.');
                    return;
                }
                
                try {
                    // Tenta di analizzare i dati come CSV
                    const importedArticles = parseCSV(importData);
                    
                    if (importedArticles && importedArticles.length > 0) {
                        // Chiedi conferma prima di sovrascrivere o aggiungere
                        const confirmAction = confirm('Vuoi sovrascrivere gli articoli esistenti (OK) o aggiungerli a quelli attuali (Annulla)?');
                        
                        if (confirmAction) {
                            // Sovrascrive gli articoli esistenti
                            savedArticles = importedArticles;
                        } else {
                            // Aggiunge gli articoli importati a quelli esistenti
                            savedArticles = [...savedArticles, ...importedArticles];
                        }
                        
                        saveArticlesToLocalStorage();
                        updateSavedArticlesTable();
                        importExportModal.style.display = 'none';
                        showStatus('success', `Importati ${importedArticles.length} articoli con successo!`);
                    } else {
                        showStatus('error', 'Nessun articolo valido trovato nei dati importati.');
                    }
                } catch (error) {
                    showStatus('error', `Errore durante l'importazione: ${error.message}`);
                }
            });
            
            // Event listener per scaricare i dati come CSV
            downloadCsvBtn.addEventListener('click', function() {
                const csv = importExportTextarea.value;
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `rassegna_stampa_export_${formatDateFileName(new Date())}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            
            // Quando si clicca fuori dal modal, chiudilo
            window.addEventListener('click', function(event) {
                if (event.target === pressReviewModal) {
                    pressReviewModal.style.display = 'none';
                }
                if (event.target === importExportModal) {
                    importExportModal.style.display = 'none';
                }
            });
            
            // Funzione per mostrare messaggi di stato
            function showStatus(type, message) {
                statusMessage.textContent = message;
                statusMessage.className = '';
                
                if (type === 'error') {
                    statusMessage.classList.add('error');
                } else if (type === 'success') {
                    statusMessage.classList.add('success');
                } else if (type === 'loading') {
                    statusMessage.classList.add('loading');
                } else if (type === 'info') {
                    statusMessage.classList.add('info');
                }
                
                // Rimuovi il messaggio dopo 5 secondi per i messaggi di successo
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        statusMessage.textContent = '';
                        statusMessage.className = '';
                    }, 5000);
                }
            }
            
            // Funzione per estrarre le informazioni dell'articolo
            function extractArticleInfo(domElement, url) {
                // Oggetto che conterrà tutte le informazioni estratte
                const articleInfo = {
                    title: '',
                    author: '',
                    content: '',
                    rawContent: ''
                };
                
                // Estrai il titolo
                articleInfo.title = extractTitle(domElement);
                
                // Estrai l'autore
                articleInfo.author = extractAuthor(domElement);
                
                // Estrai il contenuto dell'articolo
                const contentResult = extractArticleContent(domElement);
                articleInfo.content = contentResult.formattedContent;
                articleInfo.rawContent = contentResult.rawContent;
                
                return articleInfo;
            }
            
            // Funzione per estrarre il titolo
            function extractTitle(domElement) {
                // Strategia 1: Cerca il tag title
                const titleTag = domElement.querySelector('title');
                if (titleTag && titleTag.textContent.trim()) {
                    // Pulisci il titolo (rimuovi il nome del sito se presente)
                    let title = titleTag.textContent.trim();
                    // Rimuovi parti comuni alla fine del titolo come " | Nome del sito"
                    title = title.split(/\s[|\-–—]\s/)[0];
                    return title;
                }
                
                // Strategia 2: Cerca l'elemento h1
                const h1Tags = domElement.querySelectorAll('h1');
                if (h1Tags.length > 0) {
                    // Prendi l'h1 più lungo come probabile titolo
                    let longestH1 = '';
                    for (const h1 of h1Tags) {
                        const text = h1.textContent.trim();
                        if (text.length > longestH1.length) {
                            longestH1 = text;
                        }
                    }
                    if (longestH1) return longestH1;
                }
                
                // Strategia 3: Cerca meta tags
                const metaTitleTag = domElement.querySelector('meta[property="og:title"], meta[name="twitter:title"]');
                if (metaTitleTag && metaTitleTag.getAttribute('content')) {
                    return metaTitleTag.getAttribute('content').trim();
                }
                
                // Strategia 4: Cerca elementi con classe o id che contengono "title"
                const titleElements = domElement.querySelectorAll('[class*="title"], [id*="title"], .headline, .heading');
                if (titleElements.length > 0) {
                    for (const el of titleElements) {
                        const text = el.textContent.trim();
                        if (text.length > 10 && text.length < 200) {
                            return text;
                        }
                    }
                }
                
                return 'Titolo non trovato';
            }
            
            // Funzione per estrarre l'autore
            function extractAuthor(domElement) {
                // Strategia 1: Cerca meta tags per l'autore
                const metaAuthorTag = domElement.querySelector('meta[name="author"], meta[property="article:author"], meta[name="twitter:creator"]');
                if (metaAuthorTag && metaAuthorTag.getAttribute('content')) {
                    return metaAuthorTag.getAttribute('content').trim();
                }
                
                // Strategia 2: Cerca elementi con classe o id che contengono "author"
                const authorSelectors = [
                    '[class*="author"]', 
                    '[id*="author"]', 
                    '[rel="author"]',
                    '.byline',
                    '.writer',
                    '[class*="byline"]',
                    '[class*="by-"]'
                ];
                
                const authorElements = domElement.querySelectorAll(authorSelectors.join(', '));
                if (authorElements.length > 0) {
                    for (const el of authorElements) {
                        const text = el.textContent.trim();
                        // Evita testi troppo lunghi o troppo corti
                        if (text.length > 3 && text.length < 100) {
                            // Cerca di pulire il testo (rimuovere "By", "Author:", ecc.)
                            let cleanedText = text.replace(/^(by|author|written by|posted by)[\s:]+/i, '').trim();
                            // Se il testo è ancora valido, restituiscilo
                            if (cleanedText.length > 3) {
                                return cleanedText;
                            }
                        }
                    }
                }
                
                // Strategia 3: Cerca schemi strutturati (Schema.org)
                const personElements = domElement.querySelectorAll('[itemtype*="schema.org/Person"]');
                if (personElements.length > 0) {
                    for (const el of personElements) {
                        const nameEl = el.querySelector('[itemprop="name"]');
                        if (nameEl && nameEl.textContent.trim()) {
                            return nameEl.textContent.trim();
                        }
                    }
                }
                
                return '';
            }
            
            // Funzione per estrarre il contenuto dell'articolo
            function extractArticleContent(domElement) {
                // Risultato dell'estrazione
                const result = {
                    formattedContent: '',
                    rawContent: ''
                };
                
                // Strategia 1: Cerca elementi con tag semantici per articoli
                let contentElement = null;
                
                // Cerca l'elemento article
                const articleElements = domElement.querySelectorAll('article');
                if (articleElements.length > 0) {
                    // Prendi l'elemento article più grande
                    let largestArticle = articleElements[0];
                    let maxLength = articleElements[0].textContent.length;
                    
                    for (let i = 1; i < articleElements.length; i++) {
                        const length = articleElements[i].textContent.length;
                        if (length > maxLength) {
                            maxLength = length;
                            largestArticle = articleElements[i];
                        }
                    }
                    
                    contentElement = largestArticle;
                }
                
                // Se non è stato trovato un elemento article valido, cerca nella sezione principale
                if (!contentElement || contentElement.textContent.trim().length < 100) {
                    const mainElements = domElement.querySelectorAll('main');
                    if (mainElements.length > 0) {
                        contentElement = mainElements[0];
                    }
                }
                
                // Se non è stato trovato né article né main, cerca div con classi o ID comuni per articoli
                if (!contentElement || contentElement.textContent.trim().length < 100) {
                    const potentialContainers = domElement.querySelectorAll('div[class*="article"], div[class*="content"], div[class*="post"], div[id*="article"], div[id*="content"], div[id*="post"], [itemprop="articleBody"]');
                    if (potentialContainers.length > 0) {
                        // Prendi il container più grande che è probabile contenga l'articolo
                        let largestContainer = potentialContainers[0];
                        let maxLength = largestContainer.textContent.length;
                        
                        for (let i = 1; i < potentialContainers.length; i++) {
                            const currentLength = potentialContainers[i].textContent.length;
                            if (currentLength > maxLength) {
                                maxLength = currentLength;
                                largestContainer = potentialContainers[i];
                            }
                        }
                        
                        contentElement = largestContainer;
                    }
                }
                
                // Se abbiamo trovato un elemento di contenuto, estraiamo il testo
                if (contentElement && contentElement.textContent.trim().length > 100) {
                    result.formattedContent = cleanAndFormatContent(contentElement);
                    result.rawContent = extractRawText(contentElement);
                    return result;
                }
                
                // Strategia 4: Come ultima risorsa, cerca paragrafi lunghi
                const paragraphs = domElement.querySelectorAll('p');
                if (paragraphs.length > 0) {
                    // Filtra i paragrafi che sono probabilmente parte dell'articolo
                    const contentParagraphs = Array.from(paragraphs).filter(p => {
                        const text = p.textContent.trim();
                        return text.length > 80 && text.split(' ').length > 15;
                    });
                    
                    if (contentParagraphs.length > 0) {
                        result.formattedContent = contentParagraphs.map(p => `<p>${p.textContent}</p>`).join('');
                        result.rawContent = contentParagraphs.map(p => p.textContent).join('\n\n');
                        return result;
                    }
                }
                
                // Fallback: Prendi tutto il testo del body
                const bodyText = domElement.querySelector('body').textContent.trim();
                result.formattedContent = 'Impossibile identificare chiaramente il contenuto dell\'articolo.';
                result.rawContent = 'Impossibile identificare chiaramente il contenuto dell\'articolo.';
                return result;
            }
            
            // Funzione per pulire e formattare il contenuto
            function cleanAndFormatContent(element) {
                // Clona l'elemento per non modificare l'originale
                const clone = element.cloneNode(true);
                
                // Rimuovi elementi che non sono generalmente parte del contenuto
                const elementsToRemove = [
                    'script', 'style', 'nav', 'header', 'footer', 'aside', 'iframe', 'form', 
                    '.comments', '.sidebar', '.ad', '.advertisement', '.banner', '.share', '.social',
                    '.related', '.recommended', 'figcaption', '.caption', '.newsletter'
                ];
                
                elementsToRemove.forEach(selector => {
                    const elements = clone.querySelectorAll(selector);
                    elements.forEach(el => el.remove());
                });
                
                // Estrai il testo formattato mantenendo paragrafi e titoli
                let result = '';
                const contentElements = clone.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, blockquote');
                
                contentElements.forEach(el => {
                    const tagName = el.tagName.toLowerCase();
                    const text = el.textContent.trim();
                    
                    if (text.length > 0) {
                        if (tagName.startsWith('h')) {
                            result += `<${tagName}>${text}</${tagName}>`;
                        } else if (tagName === 'li') {
                            result += `<li>${text}</li>`;
                        } else if (tagName === 'blockquote') {
                            result += `<blockquote>${text}</blockquote>`;
                        } else {
                            result += `<p>${text}</p>`;
                        }
                    }
                });
                
                // Se non ci sono elementi formattati, prendi tutto il testo
                if (result.trim() === '') {
                    result = `<p>${clone.textContent.trim().replace(/[\n\r]+/g, '</p><p>').replace(/\s{2,}/g, ' ')}</p>`;
                }
                
                return result;
            }
            
            // Funzione per estrarre il testo raw
            function extractRawText(element) {
                // Clona l'elemento per non modificare l'originale
                const clone = element.cloneNode(true);
                
                // Rimuovi elementi che non sono generalmente parte del contenuto
                const elementsToRemove = [
                    'script', 'style', 'nav', 'header', 'footer', 'aside', 'iframe', 'form', 
                    '.comments', '.sidebar', '.ad', '.advertisement', '.banner', '.share', '.social',
                    '.related', '.recommended', 'figcaption', '.caption', '.newsletter'
                ];
                
                elementsToRemove.forEach(selector => {
                    const elements = clone.querySelectorAll(selector);
                    elements.forEach(el => el.remove());
                });
                
                // Estrai paragrafi e titoli
                const paragraphs = [];
                const contentElements = clone.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, blockquote');
                
                contentElements.forEach(el => {
                    const tagName = el.tagName.toLowerCase();
                    const text = el.textContent.trim();
                    
                    if (text.length > 0) {
                        if (tagName.startsWith('h')) {
                            // Aggiungi spazio extra per i titoli
                            paragraphs.push(text + "\n");
                        } else {
                            paragraphs.push(text);
                        }
                    }
                });
                
                // Se non ci sono elementi, prendi tutto il testo
                if (paragraphs.length === 0) {
                    return clone.textContent.trim()
                        .replace(/[\n\r]+/g, '\n\n')
                        .replace(/\s{2,}/g, ' ');
                }
                
                return paragraphs.join('\n\n');
            }
            
            // Funzione per aggiornare la tabella degli articoli salvati
            function updateSavedArticlesTable() {
                // Mostra il container degli articoli salvati se ci sono articoli
                if (savedArticles.length > 0) {
                    savedArticlesContainer.style.display = 'block';
                    
                    // Pulisci la tabella
                    savedArticlesBody.innerHTML = '';
                    
                    // Ordina gli articoli per data di creazione (più recenti prima)
                    const sortedArticles = [...savedArticles].sort((a, b) => 
                        new Date(b.createdDate) - new Date(a.createdDate)
                    );
                    
                    // Aggiungi le righe per ogni articolo
                    sortedArticles.forEach(article => {
                        const row = document.createElement('tr');
                        
                        const titleCell = document.createElement('td');
                        titleCell.textContent = article.title;
                        row.appendChild(titleCell);
                        
                        const sourceCell = document.createElement('td');
                        sourceCell.textContent = article.sourceName || 'N/A';
                        row.appendChild(sourceCell);
                        
                        const authorCell = document.createElement('td');
                        authorCell.textContent = article.author || 'N/A';
                        row.appendChild(authorCell);
                        
                        const actionsCell = document.createElement('td');
                        actionsCell.className = 'action-cell';
                        
                        // Pulsante Modifica
                        const editBtn = document.createElement('button');
                        editBtn.textContent = 'Modifica';
                        editBtn.addEventListener('click', () => editArticle(article.id));
                        actionsCell.appendChild(editBtn);
                        
                        // Pulsante Elimina
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'Elimina';
                        deleteBtn.style.backgroundColor = 'var(--error-color)';
                        deleteBtn.addEventListener('click', () => deleteArticle(article.id));
                        actionsCell.appendChild(deleteBtn);
                        
                        row.appendChild(actionsCell);
                        
                        savedArticlesBody.appendChild(row);
                    });
                    
                    // Mostra o nascondi il pulsante di generazione rassegna stampa
                    generatePressReviewBtn.style.display = savedArticles.length > 0 ? 'inline-block' : 'none';
                } else {
                    // Svuota la tabella e aggiungi un messaggio
                    savedArticlesBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">Nessun articolo salvato.</td></tr>';
                    // Nascondi il pulsante per generare rassegna
                    generatePressReviewBtn.style.display = 'none';
                }
            }
            
            // Funzione per aggiornare la tabella delle rassegne salvate
            function updateSavedReviewsTable() {
                savedReviewsContainer.style.display = 'block';
                
                if (savedPressReviews.length > 0) {
                    // Pulisci la tabella
                    savedReviewsBody.innerHTML = '';
                    
                    // Ordina le rassegne per data di creazione (più recenti prima)
                    const sortedReviews = [...savedPressReviews].sort((a, b) => 
                        new Date(b.createdDate) - new Date(a.createdDate)
                    );
                    
                    // Aggiungi le righe per ogni rassegna
                    sortedReviews.forEach(review => {
                        const row = document.createElement('tr');
                        
                        const titleCell = document.createElement('td');
                        titleCell.textContent = review.title;
                        row.appendChild(titleCell);
                        
                        const dateCell = document.createElement('td');
                        dateCell.textContent = formatDateShort(new Date(review.date));
                        row.appendChild(dateCell);
                        
                        const articlesCell = document.createElement('td');
                        articlesCell.textContent = review.articles.length;
                        row.appendChild(articlesCell);
                        
                        const actionsCell = document.createElement('td');
                        actionsCell.className = 'action-cell';
                        
                        // Pulsante Visualizza
                        const viewBtn = document.createElement('button');
                        viewBtn.textContent = 'Visualizza';
                        viewBtn.addEventListener('click', () => viewReview(review.id));
                        actionsCell.appendChild(viewBtn);
                        
                        // Pulsante Elimina
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'Elimina';
                        deleteBtn.style.backgroundColor = 'var(--error-color)';
                        deleteBtn.addEventListener('click', () => deleteReview(review.id));
                        actionsCell.appendChild(deleteBtn);
                        
                        row.appendChild(actionsCell);
                        
                        savedReviewsBody.appendChild(row);
                    });
                } else {
                    // Svuota la tabella e aggiungi un messaggio
                    savedReviewsBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">Nessuna rassegna stampa salvata.</td></tr>';
                }
            }
            
            // Funzione per visualizzare una rassegna
            function viewReview(reviewId) {
                const review = savedPressReviews.find(r => r.id === reviewId);
                if (!review) return;
                
                // Imposta la rassegna corrente
                currentReview = review;
                
                // Imposta direttamente il contenuto HTML salvato
                pressReviewContent.innerHTML = review.htmlContent;
                
                // Mostra il modal
                pressReviewModal.style.display = 'block';
            }
            
            // Funzione per eliminare una rassegna
            function deleteReview(reviewId) {
                if (confirm('Sei sicuro di voler eliminare questa rassegna stampa?')) {
                    // Rimuovi la rassegna dall'array
                    savedPressReviews = savedPressReviews.filter(r => r.id !== reviewId);
                    
                    // Aggiorna il localStorage
                    saveReviewsToLocalStorage();
                    
                    // Aggiorna la tabella
                    updateSavedReviewsTable();
                    
                    showStatus('success', 'Rassegna stampa eliminata con successo.');
                }
            }
            
            // Funzione per modificare un articolo
            function editArticle(articleId) {
                const article = savedArticles.find(a => a.id === articleId);
                if (!article) return;
                
                // Popola i campi con i dati dell'articolo
                titleField.value = article.title;
                authorField.value = article.author || '';
                urlField.value = article.url || '';
                sourceNameField.value = article.sourceName || '';
                contentField.value = article.content;
                
                // Salva riferimento all'articolo corrente
                currentEditArticle = article;
                
                // Mostra i risultati dell'estrazione
                extractionResults.style.display = 'block';
                
                // Scorrimento verso l'alto
                window.scrollTo(0, 0);
                
                showStatus('success', 'Modifica l\'articolo e salva le modifiche.');
            }
            
            // Funzione per eliminare un articolo
            function deleteArticle(articleId) {
                if (confirm('Sei sicuro di voler eliminare questo articolo?')) {
                    // Rimuovi l'articolo dall'array
                    savedArticles = savedArticles.filter(a => a.id !== articleId);
                    
                    // Aggiorna il localStorage
                    saveArticlesToLocalStorage();
                    
                    // Aggiorna la tabella
                    updateSavedArticlesTable();
                    
                    showStatus('success', 'Articolo eliminato con successo.');
                }
            }
            
            // Funzione per generare la rassegna stampa
            function generatePressReview() {
                const currentDate = new Date();
                const formattedDate = formatDate(currentDate);
                
                // Crea l'intestazione della rassegna stampa
                let reviewHTML = `
                    <div class="press-review-header">
                        <div class="press-review-title">Fattariellows of the day</div>
                        <div class="press-review-date">${formattedDate}</div>
                    </div>
                    <div class="press-review-articles">
                `;
                
                // Aggiungi ogni articolo
                savedArticles.forEach(article => {
                    reviewHTML += `
                        <div class="press-review-article">
                            <div class="article-title">${article.title}</div>
                            <div class="article-source">${article.sourceName || 'Fonte sconosciuta'}</div>
                            ${article.author ? `<div class="article-author">${article.author}</div>` : ''}
                            <div class="article-content">
                                ${formatArticleForReview(article.content)}
                            </div>
                        </div>
                    `;
                });
                
                reviewHTML += '</div>'; // Chiudi press-review-articles
                
                // Imposta il contenuto nel modal
                pressReviewContent.innerHTML = reviewHTML;
                
                // Aggiungi i capilettera
                addDropcaps();
            }
            
            // Funzione per aggiungere i capilettera
            function addDropcaps() {
                const articleContents = pressReviewContent.querySelectorAll('.article-content');
                
                articleContents.forEach(contentDiv => {
                    // Trova il primo paragrafo
                    const firstParagraph = contentDiv.querySelector('p');
                    if (firstParagraph) {
                        const text = firstParagraph.textContent.trim();
                        if (text.length > 0) {
                            const firstChar = text.charAt(0);
                            const restOfText = text.slice(1);
                            
                            // Sostituisci il contenuto con il capolettera
                            firstParagraph.innerHTML = `<span class="dropcap">${firstChar}</span>${restOfText}`;
                            
                            // Rimuovi text-indent dal primo paragrafo per evitare spazi strani
                            firstParagraph.style.textIndent = '0';
                        }
                    }
                });
            }
            
            // Funzione per formattare l'articolo per la rassegna
            function formatArticleForReview(content) {
                // Se il contenuto è già in HTML con tag <p>
                if (content.includes('<p>') || content.includes('<h')) {
                    return content;
                }
                
                // Altrimenti, converti le interruzioni di riga in paragrafi
                return content
                    .split('\n\n')
                    .map(paragraph => paragraph.trim())
                    .filter(paragraph => paragraph.length > 0)
                    .map(paragraph => `<p>${paragraph}</p>`)
                    .join('');
            }
            
            // Funzione per prepararsi all'esportazione dei dati
            function prepareExport() {
                // Nasconde/mostra i pulsanti appropriati
                confirmImportBtn.style.display = 'none';
                copyExportBtn.style.display = 'inline-block';
                downloadCsvBtn.style.display = 'inline-block';
                
                // Imposta il titolo e la descrizione
                importExportTitle.textContent = 'Esporta Dati';
                importExportDescription.textContent = 'Copia i dati sottostanti o salvali in un file CSV per backup.';
                
                // Genera il CSV
                const csvContent = generateCSV();
                importExportTextarea.value = csvContent;
            }
            
            // Funzione per prepararsi all'importazione dei dati
            function prepareImport() {
                // Nasconde/mostra i pulsanti appropriati
                confirmImportBtn.style.display = 'inline-block';
                copyExportBtn.style.display = 'none';
                downloadCsvBtn.style.display = 'none';
                
                // Imposta il titolo e la descrizione
                importExportTitle.textContent = 'Importa Dati';
                importExportDescription.textContent = 'Incolla qui i dati CSV da importare.';
                
                // Pulisci l'area di testo
                importExportTextarea.value = '';
            }
            
            // Funzione per generare CSV dagli articoli
            function generateCSV() {
                // Intestazioni CSV
                const headers = ['id', 'title', 'author', 'sourceName', 'url', 'content', 'createdDate', 'modifiedDate'];
                
                // Crea la riga di intestazione
                let csv = headers.join(',') + '\n';
                
                // Aggiungi ogni articolo
                savedArticles.forEach(article => {
                    const row = headers.map(header => {
                        // Gestisci i campi di testo con virgole o virgolette
                        if (typeof article[header] === 'string') {
                            // Sostituisci le virgolette con doppia virgoletta (standard CSV)
                            const escaped = article[header].replace(/"/g, '""');
                            // Racchiudi tra virgolette per gestire virgole e interruzioni di riga
                            return `"${escaped}"`;
                        }
                        return article[header] || '';
                    });
                    
                    csv += row.join(',') + '\n';
                });
                
                return csv;
            }
            
            // Funzione per analizzare dati CSV
            function parseCSV(csvData) {
                const rows = csvData.split('\n');
                const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                // Verifica che i dati contengano le intestazioni necessarie
                const requiredHeaders = ['title', 'content'];
                const hasRequiredHeaders = requiredHeaders.every(header => 
                    headers.includes(header)
                );
                
                if (!hasRequiredHeaders) {
                    throw new Error('Il formato CSV non è valido. Mancano intestazioni obbligatorie.');
                }
                
                const articles = [];
                
                // Analizza le righe di dati (salta l'intestazione)
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i].trim();
                    if (!row) continue; // Salta righe vuote
                    
                    // Gestisce valori tra virgolette contenenti virgole
                    let values = [];
                    let inQuotes = false;
                    let currentValue = '';
                    
                    for (let j = 0; j < row.length; j++) {
                        const char = row[j];
                        
                        if (char === '"') {
                            if (j < row.length - 1 && row[j + 1] === '"') {
                                // Gestisce le virgolette doppie escape
                                currentValue += '"';
                                j++; // Salta il carattere successivo
                            } else {
                                inQuotes = !inQuotes;
                            }
                        } else if (char === ',' && !inQuotes) {
                            values.push(currentValue);
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    
                    // Aggiungi l'ultimo valore
                    values.push(currentValue);
                    
                    // Crea un oggetto articolo con i valori analizzati
                    const article = {};
                    headers.forEach((header, index) => {
                        if (index < values.length) {
                            article[header] = values[index];
                        } else {
                            article[header] = '';
                        }
                    });
                    
                    // Verifica che l'articolo abbia i campi obbligatori
                    if (article.title && article.content) {
                        // Assicurati che ogni articolo abbia un ID unico
                        if (!article.id) {
                            article.id = generateUniqueId();
                        }
                        // Imposta date se mancanti
                        if (!article.createdDate) {
                            article.createdDate = new Date().toISOString();
                        }
                        if (!article.modifiedDate) {
                            article.modifiedDate = new Date().toISOString();
                        }
                        
                        articles.push(article);
                    }
                }
                
                return articles;
            }
            
            // Funzione per generare un ID unico
            function generateUniqueId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }
            
            // Funzione per formattare la data in formato esteso italiano
            function formatDate(date) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('it-IT', options);
            }
            
            // Funzione per formattare la data in formato compatto
            function formatDateShort(date) {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return date.toLocaleDateString('it-IT', options);
            }
            
            // Funzione per formattare la data nel nome del file
            function formatDateFileName(date) {
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
            }
            
            // Funzione per salvare gli articoli nel localStorage
            function saveArticlesToLocalStorage() {
                localStorage.setItem('savedArticles', JSON.stringify(savedArticles));
            }
            
            // Funzione per salvare le rassegne nel localStorage
            function saveReviewsToLocalStorage() {
                localStorage.setItem('savedPressReviews', JSON.stringify(savedPressReviews));
            }
            
            // Funzione per caricare i dati salvati dal localStorage
            function loadSavedData() {
                // Carica gli articoli
                const savedArticlesJson = localStorage.getItem('savedArticles');
                if (savedArticlesJson) {
                    try {
                        savedArticles = JSON.parse(savedArticlesJson);
                        updateSavedArticlesTable();
                    } catch (e) {
                        console.error('Errore nel caricamento degli articoli salvati:', e);
                    }
                }
                
                // Carica le rassegne
                const savedReviewsJson = localStorage.getItem('savedPressReviews');
                if (savedReviewsJson) {
                    try {
                        savedPressReviews = JSON.parse(savedReviewsJson);
                        updateSavedReviewsTable();
                    } catch (e) {
                        console.error('Errore nel caricamento delle rassegne salvate:', e);
                    }
                }
            }
            
            // Funzione per resettare i campi di estrazione
            function resetExtractionFields() {
                titleField.value = '';
                authorField.value = '';
                urlField.value = '';
                sourceNameField.value = '';
                contentField.value = '';
            }
            
            // Inizializza la pagina
            updateSavedArticlesTable();
            updateSavedReviewsTable();
        });
    </script>
</body>
</html>
