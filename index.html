<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estrattore di Testo da Articoli Web</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .form-container {
            margin-bottom: 20px;
        }
        input[type="url"] {
            width: 70%;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Estrattore di Testo da Articoli Web</h1>
    
    <div class="form-container">
        <input type="url" id="url-input" placeholder="Inserisci l'URL dell'articolo..." required>
        <button id="extract-button">Estrai Testo</button>
    </div>
    
    <div id="result">
        <p>Il testo estratto dall'articolo apparirà qui.</p>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('url-input');
            const extractButton = document.getElementById('extract-button');
            const resultContainer = document.getElementById('result');
            
            extractButton.addEventListener('click', function() {
                const url = urlInput.value.trim();
                
                if (!url) {
                    resultContainer.innerHTML = '<p class="error">Per favore, inserisci un URL valido.</p>';
                    return;
                }
                
                // Mostra lo stato di caricamento
                resultContainer.innerHTML = '<p class="loading">Estrazione in corso...</p>';
                
                // Utilizziamo un proxy CORS per aggirare le restrizioni di sicurezza
                const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
                
                fetch(proxyUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Errore durante il recupero della pagina web');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Crea un elemento DOM temporaneo per analizzare l'HTML
                        const tempEl = document.createElement('div');
                        tempEl.innerHTML = data.contents;
                        
                        // Tenta di estrarre il contenuto dell'articolo
                        let articleText = extractArticleContent(tempEl);
                        
                        if (articleText.trim() === '') {
                            resultContainer.innerHTML = '<p class="error">Nessun contenuto di articolo identificabile trovato.</p>';
                        } else {
                            resultContainer.innerHTML = articleText;
                        }
                    })
                    .catch(error => {
                        resultContainer.innerHTML = `<p class="error">Errore: ${error.message}</p>`;
                    });
            });
            
            function extractArticleContent(domElement) {
                // Strategia 1: Cerca elementi con tag semantici per articoli
                let content = '';
                
                // Cerca l'elemento article
                const articleElements = domElement.querySelectorAll('article');
                if (articleElements.length > 0) {
                    // Prendi il primo elemento article
                    const mainArticle = articleElements[0];
                    content = cleanAndFormatContent(mainArticle);
                    if (content.trim().length > 100) {
                        return content;
                    }
                }
                
                // Strategia 2: Cerca contenuto nella sezione principale
                const mainElements = domElement.querySelectorAll('main');
                if (mainElements.length > 0) {
                    const mainContent = mainElements[0];
                    content = cleanAndFormatContent(mainContent);
                    if (content.trim().length > 100) {
                        return content;
                    }
                }
                
                // Strategia 3: Cerca div con classi o ID comuni per articoli
                const potentialArticleContainers = domElement.querySelectorAll('div[class*="article"], div[class*="content"], div[class*="post"], div[id*="article"], div[id*="content"], div[id*="post"]');
                if (potentialArticleContainers.length > 0) {
                    // Prendi il container più grande che è probabile contenga l'articolo
                    let largestContainer = potentialArticleContainers[0];
                    let maxLength = largestContainer.textContent.length;
                    
                    for (let i = 1; i < potentialArticleContainers.length; i++) {
                        const currentLength = potentialArticleContainers[i].textContent.length;
                        if (currentLength > maxLength) {
                            maxLength = currentLength;
                            largestContainer = potentialArticleContainers[i];
                        }
                    }
                    
                    content = cleanAndFormatContent(largestContainer);
                    if (content.trim().length > 100) {
                        return content;
                    }
                }
                
                // Strategia 4: Cerca paragrafi lunghi
                const paragraphs = domElement.querySelectorAll('p');
                if (paragraphs.length > 0) {
                    // Filtra i paragrafi che sono probabilmente parte dell'articolo
                    const contentParagraphs = Array.from(paragraphs).filter(p => {
                        const text = p.textContent.trim();
                        return text.length > 50 && text.split(' ').length > 10;
                    });
                    
                    if (contentParagraphs.length > 0) {
                        content = contentParagraphs.map(p => `<p>${p.textContent}</p>`).join('');
                        return content;
                    }
                }
                
                // Fallback: Ritorna tutto il contenuto testuale del corpo
                return 'Nessun articolo identificato chiaramente. Ecco il testo della pagina:<br>' + 
                       domElement.querySelector('body').textContent.trim()
                       .replace(/[\n\r]+/g, '<br>')
                       .replace(/\s{2,}/g, ' ');
            }
            
            function cleanAndFormatContent(element) {
                // Clona l'elemento per non modificare l'originale
                const clone = element.cloneNode(true);
                
                // Rimuovi elementi che non sono generalmente parte del contenuto
                const elementsToRemove = ['script', 'style', 'nav', 'header', 'footer', 'aside', 'iframe', 'form', '.comments', '.sidebar', '.ad', '.advertisement', '.banner'];
                elementsToRemove.forEach(selector => {
                    const elements = clone.querySelectorAll(selector);
                    elements.forEach(el => el.remove());
                });
                
                // Estrai il testo formattato mantenendo paragrafi e titoli
                let result = '';
                const contentElements = clone.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, blockquote');
                
                contentElements.forEach(el => {
                    const tagName = el.tagName.toLowerCase();
                    const text = el.textContent.trim();
                    
                    if (text.length > 0) {
                        if (tagName.startsWith('h')) {
                            result += `<${tagName}>${text}</${tagName}>`;
                        } else if (tagName === 'li') {
                            result += `<li>${text}</li>`;
                        } else if (tagName === 'blockquote') {
                            result += `<blockquote>${text}</blockquote>`;
                        } else {
                            result += `<p>${text}</p>`;
                        }
                    }
                });
                
                // Se non ci sono elementi formattati, prendi tutto il testo
                if (result.trim() === '') {
                    result = `<p>${clone.textContent.trim().replace(/[\n\r]+/g, '</p><p>').replace(/\s{2,}/g, ' ')}</p>`;
                }
                
                return result;
            }
        });
    </script>
</body>
</html>
